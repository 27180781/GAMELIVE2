<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ממשק שחקן</title>
  <link rel="stylesheet" href="styles.css">
  <script src="config.js"></script>
</head>
<body style="margin:0; padding:0;">
  <div id="container" style="display:flex; height:100vh;">
    <!-- עמודת משחק: שלט המשחק למעלה (2/3), מצלמת המפעיל למטה (1/3) -->
    <div id="game-section" style="flex:1; display:flex; flex-direction:column;">
      <!-- 2/3 -->
      <div id="game-ui" style="flex:2; border-bottom:1px solid #333;">
        <iframe
          id="gamePanel"
          src=""
          style="width:100%; height:100%; border:none;"
        ></iframe>
      </div>
      <!-- 1/3 -->
      <div id="camera-region"
           style="flex:1; background:#111; display:flex; align-items:center; justify-content:center;">
        <div id="host-video" style="width:100%; height:100%;"></div>
      </div>
    </div>
  </div>

  <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.14.0.js"></script>
  <script>
    const urlParams    = new URLSearchParams(location.search);
    const CHANNEL_NAME = urlParams.get('channel');
    const GAME_CODE    = urlParams.get('gamecode');

    // הכנס כאן את הקישור לשלט המשחק שלך
    const gameUIUrl = `https://game.clicker.co.il/phone.html?code=${encodeURIComponent(GAME_CODE)}`;
    document.getElementById('gamePanel').src = gameUIUrl;

    const client = AgoraRTC.createClient({ mode: 'rtc', codec: 'vp8' });
    client.on('user-published', async (user, mediaType) => {
      await client.subscribe(user, mediaType);
      if (mediaType === 'video') {
        // מציג רק את הווידאו (מצלמת המפעיל) בתחתית
        document.getElementById('host-video').innerHTML = '';
        user.videoTrack.play('host-video');
      }
      if (mediaType === 'audio') {
        user.audioTrack.play();
      }
    });

    // ההצטרפות כמשתמש רק למנוי (אין publish)
    (async () => {
      await client.join(AGORA_APP_ID, CHANNEL_NAME, AGORA_TOKEN, null);
    })();
  </script>
</body>
</html>
